/*! ClickStreamClient_1 v1.9.1; build: #20100 */
var ClickStreamClient_1;(()=>{var e,r,t,n,o={d:(e,r)=>{for(var t in r)o.o(r,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p:"/"},a={};n="ClickStreamClient_1",o.p=(e=document.querySelector("script[src*="+n+"]"),r=e&&e.src,t=new RegExp(n+".js.*$"),r?r.replace(t,""):"/"),(()=>{"use strict";o.r(a),o.d(a,{init:()=>Te,sendEvent:()=>ke,sendEvents:()=>Ce,setConfig:()=>Ae,updateSessionParams:()=>xe});function e(e,r,t){return(r=function(e){var r=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==typeof r?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}class r extends Error{constructor(r,t){super(`API Error: ${r}`),e(this,"status",void 0),e(this,"data",void 0),this.name="ApiError",this.status=r,this.data=t}}const t={"Content-Type":"application/json"},n=(e=>{const{size:r,concurrency:t}=e,n=[];let o=0;const a=()=>{if(o<t&&n.length){const{producer:e,resolve:r,reject:t}=n.shift();o++,e().then((e=>{o--,a(),r(e)}),(e=>{o--,a(),t(e)}))}};return{add:e=>{if(n.length+o>=r)throw new Error(`RequestBuffer Error: Buffer full. \n         Available options: size:${r}, concurrency:${t}. \n         Current buffer data: buffer.length:${n.length}, tasksInProgress:${o}\n        `);return new Promise(((r,t)=>{n.push({producer:e,resolve:r,reject:t}),a()}))}}})({size:10,concurrency:2}),s=async e=>{let{method:o,body:a,url:s,headers:i}=e;return n.add((async()=>{const e=await fetch(s,{method:o,keepalive:!0,headers:{...t,...i},body:JSON.stringify(a)});if(!e.ok){const t=e.headers?.get("content-type")?.includes("json");if(t){const t=await e.json();throw new r(e.status,t)}{const r=await e.text();throw new Error(`Request failed with status ${e.status}: ${r}`)}}return 204===e.status?{}:e.json()}))},i=(e,r)=>s({method:"POST",url:`${e}/api/v1/token`,body:{cUid:r}}),c="CLICK_STREAM_AUTH_TOKEN",u=(()=>{let e=(()=>{try{return localStorage.getItem(c)}catch(e){return null}})(),r=null;const t=async t=>{let{baseUrl:n,clientId:o}=t;return r||(r=(async()=>{try{const r=await i(n,o);return e=r.data.token,(e=>{try{localStorage.setItem(c,e)}catch(e){}})(e),e}finally{r=null}})(),r)};return{getTokenSync:()=>e,getTokenAsync:async r=>e||t(r),generateToken:t}})(),l=e=>e instanceof r&&401===e.status,d=async e=>{const r=r=>s({...e,headers:{...e.headers,Authorization:`Bearer ${r}`}});try{const t=await u.getTokenAsync(e);return await r(t)}catch(t){if(l(t)){const t=await u.generateToken(e);return await r(t)}throw t}},m=e=>{let{baseUrl:r,clientId:t,events:n}=e;return d({baseUrl:r,clientId:t,method:"POST",url:`${r}/api/v1/events/action`,body:n})};function f(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function p(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?f(Object(t),!0).forEach((function(r){y(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function y(e,r,t){return(r=function(e){var r=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==typeof r?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function g(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}function h(e){const r=new FormData;return Object.entries(e).forEach((e=>{let[t,n]=e;r.append(t,String(n))})),r}function w(e){const r={};return Object.entries(e).forEach((e=>{let[t,n]=e;null!=n&&(r[t]=n)})),r}const _=["apiBaseUrl"];const E=["withStackTrace","message"];const v=function e(){const r=[];let t={},n=!1;function o(e){const{withStackTrace:o,message:a}=e,s=g(e,E),i=o?`${a} stacktrace: ${function(){let e;try{throw new Error}catch(r){e=r.stack}return e}()}`:a,c=p(p(p({},t),s),{},{message:i?.substring(0,2e3)});n?function(e){const{apiBaseUrl:r}=e,t=g(e,_);return window.fetch(`${r}/logger/write`,{method:"POST",body:h(t)})}(c).catch((e=>{console.error(e)})):r.push(c)}return{setup:function(e){n=!0,t=e,n&&(r.forEach(o),r.length=0)},log:function(e){o(w(p(p({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{},{message:e,log_level:"notice"})))},error:function(e){o(w(p(p({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),{},{message:e,log_level:"error"})))},warn:function(e){o(w({context:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},message:e,log_level:"warning"}))},compose:function(r){const n=e();return n.setup(p(p({},t),r)),n}}}(),b="INIT_ERROR",O="SET_CONFIG_ERROR",S="SEND_EVENTS_ERROR",R="UPDATE_SESSION_PARAMS_ERROR",P="INIT_SESSION_ACTION_ERROR",I="ACTION_SEND_ACTION_EVENT_ERROR",U="ACTION_SEND_PAGE_VIEW_EVENT_ERROR",T="ACTION_SEND_MODAL_VIEW_EVENT_ERROR",x="UTILS_GET_BROWSER_NAME_ERROR",k="UTILS_GET_BROWSER_LANGUAGE_ERROR",C="UTILS_GET_OS_ERROR",A="UTILS_GET_PLATFORM_ERROR",j="UTILS_GET_TIMEZONE_ERROR",N="UTILS_GET_REFFERER_ERROR",L="UTILS_LOCAL_STORAGE_ERROR",M="UTILS_COOKIE_ERROR",$="UTILS_MARKETING_SEARCH_PARAMS_ERROR",D="UTILS_PARSE_JWT_ERROR",q=(()=>{let e=!1;return{setup:r=>{var t;e=!(!(t=r)||!t?.baseConfig)&&Boolean(t.baseConfig?.userId)&&Boolean(t.baseConfig?.token)&&Boolean(t.baseConfig?.apiUrl),e&&v.setup({userId:String(r.baseConfig.userId),token:r.baseConfig.token,appKey:r.baseConfig.appKey,apiBaseUrl:r.baseConfig.apiUrl,name:"ClickStreamClient"})},error:r=>{let{type:t,withStackTrace:n,err:o,data:a}=r;e&&v.error(JSON.stringify({errorName:o?.name,errorMessage:o?.message,errorData:o?.response?.data,...a,document}),{type:t,withStackTrace:n})}}})(),B=async(e,r)=>{try{await m({events:e,baseUrl:r.api.baseUrl,clientId:r.api.clientId})}catch(r){q.error({type:I,err:r,data:{events:e}})}},G=e=>{let{baseUrl:r,clientId:t,events:n}=e;return d({baseUrl:r,clientId:t,method:"POST",url:`${r}/api/v1/events/page_view`,body:n})},V=async(e,r)=>{try{await G({events:e,baseUrl:r.api.baseUrl,clientId:r.api.clientId})}catch(r){q.error({type:U,err:r,data:{events:e}})}},W=e=>{let{baseUrl:r,clientId:t,events:n}=e;return d({baseUrl:r,clientId:t,method:"POST",url:`${r}/api/v1/events/modal_view`,body:n})},K=async(e,r)=>{try{await W({events:e,baseUrl:r.api.baseUrl,clientId:r.api.clientId})}catch(r){q.error({type:T,err:r,data:{events:e}})}},F=e=>e.reduce(((e,r)=>(e[r.type]||(e[r.type]=[]),e[r.type].push(r),e)),{});let z=function(e){return e.Action="action",e.ModalView="modal_view",e.PageView="page_view",e}({});const H=e=>e.type===z.Action,J=e=>e.type===z.PageView,Z=e=>e.type===z.ModalView,Q=e=>e.map((e=>e.payload)),X=(e,r)=>{const t=F(e);Object.keys(t).forEach((e=>{const n=t[e],o=Q(n);return(e=>e.every(H))(n)?B(o,r):(e=>e.every(J))(n)?V(o,r):(e=>e.every(Z))(n)?K(o,r):null}))},Y=function(){let{pageView:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=[];return e&&r.push({type:z.PageView}),r},ee=e=>{try{const r=document.cookie.match(new RegExp(`(?:^|; )${e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")}=([^;]*)`));return r?decodeURIComponent(r[1]):null}catch(e){return q.error({type:M,err:e}),null}},re=function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1800,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(e=>{const r=e.split(".");return r.length<3?e:r.slice(r.length-2,r.length).join(".")})(window.location.hostname);try{const o=encodeURIComponent(r);document.cookie=`${e}=${o}; max-age=${t}; domain=${n}; path=/; secure`}catch(e){q.error({type:M,err:e})}},te="CLICKSTREAM_SESSION_INITED",ne=e=>{let{user_uuid:r,stream_uuid:t}=e;return!(()=>{try{return Boolean(localStorage.getItem(te))}catch(e){return q.error({type:L,err:e}),!1}})()||(!ee("user_uuid")||!ee("stream_uuid")||(ee("user_uuid")!==r||ee("stream_uuid")!==t))},oe=e=>{if(!e)return null;try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return q.error({type:D,err:e}),null}};function ae(){let e=(new Date).getTime(),r="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(r+n)%16|0,r=Math.floor(r/16)),("x"===t?n:3&n|8).toString(16)}))}const se=()=>{const e=ee("user_uuid"),r=oe(ee("airSlate_session_token"))?.user_uuid,t=new URLSearchParams(window.location.search).get("cs_uu"),n=window.crypto?.randomUUID?.()||ae();return e||r||t||n},ie=()=>{const e=ee("stream_uuid"),r=new URLSearchParams(window.location.search).get("cs_su"),t=window.crypto?.randomUUID?.()||ae();return e||r||t},ce=()=>window.user?.lang||window.pdffiller?.lang||(()=>{try{return navigator.language.split("-")[0]}catch(e){return q.error({type:k,err:e}),"Unknown"}})(),ue=e=>({user_uuid:e?.user_uuid||se(),stream_uuid:e?.stream_uuid||ie(),language:e?.language||ce(),source:e?.source||"others",device:e?.device||"desktop"}),le=e=>{e.user_uuid&&re("user_uuid",e.user_uuid),e.stream_uuid&&re("stream_uuid",e.stream_uuid)},de=e=>{if(!e.api.clientId)throw new Error("clientId is not provided in clickStreamConfig.api");return{...e,sessionParams:ue(e.sessionParams),defaultTracking:e.defaultTracking||{}}},me=e=>{let{baseUrl:r,clientId:t,attrs:n}=e;return d({baseUrl:r,clientId:t,method:"POST",url:`${r}/api/v1/sessions`,body:n})},fe=()=>Math.floor(Date.now()/1e3),pe=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return q.error({type:j,err:e}),"Unknown"}},ye=(e,r)=>{let t;try{t=new URL(r)}catch{t=new URL(e)}return t},ge=e=>{const r=ye(window.location.href,e);return{queryParams:Object.fromEntries(r.searchParams),href:r.origin+r.pathname}},he=e=>{if(!e&&!document.referrer)return null;try{const r=ye(document.referrer,e);return{refHost:r.hostname,refUrl:r.origin+r.pathname,queryParams:Object.fromEntries(r.searchParams)}}catch(e){return q.error({type:N,err:e}),null}},we=()=>{try{const e=navigator.userAgent;return e.match(/opr\/|opios/i)?"Opera":e.match(/msie|trident/i)?"IE":e.match(/edg/i)?"Edge":e.match(/firefox|iceweasel|fxios/i)?"Firefox":e.match(/chromium/i)?"Chromium":e.match(/chrome|crios|crmo/i)?"Chrome":e.match(/safari|applewebkit/i)?"Safari":"Unknown"}catch(e){return q.error({type:x,err:e}),"Unknown"}},_e=()=>{try{const e=window.navigator;return e.platform||e?.userAgentData?.platform||"Unknown"}catch(e){return q.error({type:A,err:e}),"Unknown"}},Ee=()=>{try{const e=window.navigator.userAgent,r=_e(),t=["iPhone","iPad","iPod"],n=["Win32","Win64","Windows","WinCE"];return["Macintosh","MacIntel","MacPPC","Mac68K"].includes(r)?"Mac":t.includes(r)?"IOS":n.includes(r)?"Windows":/Android/.test(e)?"Android":/Linux/.test(r)?"Linux":"Unknown"}catch(e){return q.error({type:C,err:e}),"Unknown"}};function ve(e){try{const r=new URLSearchParams(e);return{utmS:r.get("utm_source")||void 0,utmT:r.get("utm_term")||void 0,utmM:r.get("utm_medium")||void 0,utmC:r.get("utm_campaign")||void 0,gclid:r.get("gclid")||void 0,msclkid:r.get("msclkid")||void 0,fbclid:r.get("fbclid")||void 0}}catch(e){return q.error({type:$,err:e}),{}}}const be=async e=>{try{await me({baseUrl:e.api.baseUrl,clientId:e.api.clientId,attrs:{uUid:e.sessionParams.user_uuid,stUid:e.sessionParams.stream_uuid,ln:e.sessionParams.language,so:e.sessionParams.source,dv:e.sessionParams.device,crAt:fe(),tz:pe(),url:ge().href,refH:he()?.refHost,refUrl:he()?.refUrl,br:we(),plf:_e(),os:Ee(),...ve(window.location?.search)}}),(()=>{try{localStorage.setItem(te,"TRUE")}catch(e){q.error({type:L,err:e})}})(),le(e.sessionParams)}catch(e){q.error({type:P,err:e})}};const Oe=function(e){return Boolean(e)&&Object.keys(e).length>0},Se=(e,r)=>{const{attrs:{e:t,lc:n,src:o,exp:a},customAttrs:s}=e;return{uUid:r.sessionParams.user_uuid,stUid:r.sessionParams.stream_uuid,crAt:fe(),e:t,lc:n,src:o,exp:a,...Oe(s)&&{attrs:s}}},Re=(e,r)=>{const{attrs:{e:t,url:n,ref:o,exp:a},customAttrs:s}=e,{href:i,queryParams:c}=ge(n),{refUrl:u,queryParams:l}=he(o)||{},d={...s,...Oe(c)&&{url_query:c},...Oe(l)&&{ref_query:l}};return{e:t,uUid:r.sessionParams.user_uuid,stUid:r.sessionParams.stream_uuid,crAt:fe(),url:i,ref:u,exp:a,...Oe(d)&&{attrs:d}}},Pe=(e,r)=>{const{attrs:{url:t,ref:n}={},customAttrs:o}=e,{href:a,queryParams:s}=ge(t),{refUrl:i,queryParams:c}=he(n)||{},u={...o,...Oe(s)&&{url_query:s},...Oe(c)&&{ref_query:c}};return{uUid:r.sessionParams.user_uuid,stUid:r.sessionParams.stream_uuid,crAt:fe(),e:"page_view",url:a,ref:i,...Oe(u)&&{attrs:u}}},Ie=(e,r)=>e.map((e=>H(e)?{...e,payload:Se(e,r)}:J(e)?{...e,payload:Pe(e,r)}:Z(e)?{...e,payload:Re(e,r)}:e)),Ue=(()=>{const[e,r,t]=function(){let e=()=>{},r=()=>{};return[new Promise(((t,n)=>{e=t,r=n})),e,r]}();let n=null;const o=e=>{try{n=de(e.clickStreamConfig)}catch(r){q.error({type:O,err:r,data:{initConfig:e}})}},a=async function(r){try{if(await e,!n)throw new Error('config is not defined. use "init" method with config');const t=Ie(r,n);X(t,n)}catch(e){q.error({type:S,err:e,data:{evts:r}})}};return{setConfig:o,init:async e=>{try{if(q.setup(e),o(e),!n)throw new Error("Error while setConfig()");ne(n.sessionParams)&&await be(n),r(!0),a(Y(n.defaultTracking))}catch(r){t(r),q.error({type:b,err:r,data:{initConfig:e}})}},updateSessionParams:async e=>{try{if(!n)throw new Error("use init() method first");n.sessionParams=ue(e),await be(n)}catch(r){q.error({type:R,err:r,data:{sessionParams:e}})}},sendEvent:function(e){return a([e],arguments.length>1&&void 0!==arguments[1]&&arguments[1])},sendEvents:a}})(),{init:Te,updateSessionParams:xe,sendEvent:ke,sendEvents:Ce,setConfig:Ae}=Ue})(),ClickStreamClient_1=a})();
//# sourceMappingURL=https://ppf-static-source-maps-20201028070046695300000001.s3.amazonaws.com/ClickStreamClient_1/20100/ClickStreamClient_1.js.map